<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <script src="./js/jquery-3.3.1.min.js"></script>
    </head>
    <body>

        <div class="controllerzone">
            <div id="zone_joystick1" class="joystickzone-left"></div>
            <div id="infozone" class="infozone">
                <h1>Robot control</h1>
                <div id="statuszone" class="statuszone">
                </div>
            </div>
            <div id="zone_joystick2" class="joystickzone-right"></div>
        </div>


        <!-- get and display robot info -->
        <script type="text/javascript">
            var start = new Date;

            setInterval(function(){
                $.ajax({
                    url: "http://"+location.host+":5000/status",
                    dataType:'json',
                    type:'GET',
                    success: function(data){
                        //console.log(data);
                        txt = "";
                        for(var key in data){
                            if(data.hasOwnProperty(key)){
                                txt += key + ":" + data[key] + "<br />";
                            }
                        }
                        $('#statuszone').html(txt);
                    },
                    error: function(){
                        $('#statuszone').html("Server is offline");
                    }
                });

            }, 1000);
        </script>

        <!-- Joyticks -->
        <script src="./js/nipplejs/dist/nipplejs.min.js"></script>
        <script>
            //----------------------- LEFT JOYSTICK
            var options = {
                zone: document.getElementById('zone_joystick1'),
                mode:"dynamic",
                size:100,
                color:"blue",
                restJoystick:false,
                restOpacity:50,
            };
            var manager = nipplejs.create(options);

            manager.on('added', function(evt, nipple){
                nipple.on('move', function(evt,data){
                    console.log(data);
                    $.ajax({
                        url: "http://"+location.host+":5000/left/"+(data.distance/options.size)+"/"+data.angle.degree,
                        dataType:'json'
                    }).then(function(returndata){
                        console.log(returndata);
                    });
                });
            }).on('removed', function(evt, nipple){
            $.ajax({
                url: "http://"+location.host+":5000/left/0.0/0.0",
                    dataType:'json'
                }).then(function(returndata){
                    console.log(returndata);
                });

                nipple.off('start move end dir plain');
            });


            //----------------------- RIGHT JOYSTICK
            var options = {
                zone: document.getElementById('zone_joystick2'),
                mode:"dynamic",
                color:"red",
                size:100,
                restJoystick:false,
                restOpacity:50,
            };
            var manager2 = nipplejs.create(options);

            manager2.on('added', function(evt, nipple){
                /*
                nipple.on('start move end dir plain', function(evt){
                    alert(evt);
                });
                */
                nipple.on('move', function(evt,data){
                    console.log(data.distance+"-"+data.angle.degree);
                    $.ajax({
                        url: "http://"+location.host+":5000/right/"+(data.distance/options.size)+"/"+data.angle.degree,
                        dataType:'jsonp'
                    }).then(function(returndata){
                        console.log(returndata);
                    });
                });
            }).on('removed', function(evt, nipple){
                nipple.off('start move end dir plain');
            });

        </script>

    </body>
</html>
