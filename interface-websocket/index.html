<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <!-- wpsites.net/web-design/circle-buttons - Alex Wolfe - BIG THANKS! -->
        <!-- <link rel="stylesheet" type="text/css" href="css/button.css"> -->
	<!--
	<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
        -->
	<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
        <script src="./js/socket.io.js"></script>
        <script src="./js/nipplejs/dist/nipplejs.js"></script>
	<script src="./js/jquery-3.3.1.min.js"></script>

	<meta name="viewport" content="width=device-width, user-scalable=no">
    </head>
    <body>

        <div class="controllerzone">
            <div id="zone_joystick1" class="joystickzone-left"></div>
            <div id="infozone" class="infozone">
                <h1>Robot control</h1>
                <div id="statuszone" class="statuszone">
                </div>
                <div id="buttonzone" class="buttonzone">
                    <!-- primary (blue), action (green), highlight (orange), caution (red), royal (purple) -->
                    <a href="#" id="button-left" class="button button-circle button-action" style="float:left;">A</a>
                    <a href="#" id="button-right" class="button button-circle button-primary" style="float:right;">B</a>
                </div>
                <br style="clear:both;" />
            </div>
            <div id="zone_joystick2" class="joystickzone-right"></div>
        </div>


        <!-- setup sockets and periodic status requests -->
        <script type="text/javascript">
            var socket_status = io.connect('http://'+location.host+":5000/status")
            socket_status.on('status', function(msg){
                $('#statuszone').text("Received:" + msg.data);
            });
            setInterval(function(){
                socket_status.emit('request');
            }, 1000);


            var socket_control = io.connect('http://'+location.host+":5000/control")

        </script>

        <!-- Joyticks -->
        <script>
            //----------------------- LEFT JOYSTICK
            var options = {
                zone: document.getElementById('zone_joystick1'),
                mode:"dynamic",
                size:100,
                color:"blue",
                restJoystick:false,
                restOpacity:50,
                fadeTime:0,
            };
            var manager = nipplejs.create(options);

            manager.on('added', function(evt, nipple){
                nipple.on('move', function(evt,data){
                    socket_control.emit('control', {data:{"left":[(data.distance/options.size), data.angle.degree]}});
                });
            }).on('removed', function(evt, nipple){
                socket_control.emit('control', {data:{"left":[0.0, 0.0]}});
                nipple.off('start move end dir plain');
            });


            //----------------------- RIGHT JOYSTICK
            var options = {
                zone: document.getElementById('zone_joystick2'),
                mode:"dynamic",
                color:"red",
                size:100,
                restJoystick:false,
                restOpacity:50,
                fadeTime:0,
            };
            var manager2 = nipplejs.create(options);

            manager2.on('added', function(evt, nipple){
                nipple.on('move', function(evt,data){
                    socket_control.emit('control', {data:{"right":[(data.distance/options.size), data.angle.degree]}});
                });
            }).on('removed', function(evt, nipple){
                socket_control.emit('control', {data:{"right":[0.0, 0.0]}});
                nipple.off('start move end dir plain');
            });

            <!-- add on-click-listeners to the buttons -->
            //$('#button-left').ontouchstart = function(){socket_control.emit('control', {data:{"A":1}})};
            $('#button-left').on('click', function(){socket_control.emit('control', {data:{"A":1}})});
            $('#button-right').on('click', function(){socket_control.emit('control', {data:{"B":1}})});


            // disable long-press context-menu
            window.oncontextmenu = function(event){
                event.preventDefault();
                event.stopPropagation();
                return false;
            }
        </script>

    </body>
</html>
