<html>
    <head>
        <!-- <link rel="stylesheet" type="text/css" href="mybutton.css"> -->
        <link rel="stylesheet" type="text/css" href="style.css">
        <meta name="viewport" content="width=device-width, user-scalable=no">
	<script src="./js/jquery-3.3.1.min.js"></script>
    </head>
    <body>

            
        <div id="leftzone" style="float:left;width:20%;height:100%;margin:0;padding:0;">
            <div id="joystick" style="width:100%;height:100%;background-color:#333;"></div>
        </div>

        <div style="float:left;width:60%;height:100%;padding:0;margin:0;">
            <div id="infozone" style="float:left;width:100%;height:50%;margin:0;padding:0;">
                <div id="output" style="float:left;width:100%;"></div>
                <div id="output2" style="float:left;width:100%;"></div>
                <div id="output3" style="float:left;width:100%;"></div>
            </div>

            <div id="buttonzone" style="float:left;width:100%;height:50%;margin:0;padding:0;">
                <a href="#" id="button1" class="button tick noSelect"></a>
                <a href="#" id="button2" class="button heart noSelect"></a>
            </div>
        </div>

        <div id="rightzone" style="float:left;width:20%;height:100%;">
            <div id="joystick2" style="width:100%;height:100%;background-color:#333;"></div>
        </div>

        <div id="joystick_base" class="joystick_base"></div>
        <div id="joystick_overlay" class="joystick_nip"></div>

        <script type="text/javascript">

            class Joystick{
                constructor(sx,sy){
                    /* start coordinates */
                    this.sx = sx;
                    this.sy = sy;
                    
                    /* create base div */
                }
            }

            $(document).ready(function(){
                $('#output').text("starting");

                var joystick_start = [-1,-1];
                var radius = 50;

                /******************************************
                  BUTTONS
                  *****************************************/
                $(document).on('touchstart touchmove', '#button1', function(evt){
                    $('#output2').html("Button1");
                    evt.preventDefault();
                });
                $(document).on('touchstart touchmove', '#button2', function(evt){
                    $('#output2').html("Button2");
                    evt.preventDefault();
                });

                /******************************************
                  JOYSTICK 1
                  *****************************************/
                /*$(document).on('touchstart touchmove', '#joystick', function(evt){*/
                $('#joystick').on('touchstart touchmove', function(evt){
                    var touch = evt.originalEvent.targetTouches[0];
                    var offset = $('#joystick').offset();
                    var x = touch.clientX - offset.left;
                    var y = touch.clientY - offset.top;
                    if (!(
                        touch.clientX <= $(this).offset().left || touch.clientX >= $(this).offset().left + $(this).outerWidth() ||
                        touch.clientY <= $(this).offset().top  || touch.clientY >= $(this).offset().top + $(this).outerHeight())){
                            //$('#output').html("joystick "+ x + ":" + y);

                        if(joystick_start[0] == -1){
                            const test = new Joystick(x,y);
                            joystick_start = [x,y];
                            //$('#output').html("joystick STARTED"+ x + ":" + y);
                        }else{
                            // calculate relative coordinates to starting point

                            if(Math.sqrt(Math.pow(x-joystick_start[0],2)+Math.pow(y-joystick_start[1], 2)) < radius){
                                $('#output').html("joystick move:"+ (x-joystick_start[0]) + ":" + (y-joystick_start[1]));

                                $('#joystick_overlay').css("display","block");
                                $('#joystick_overlay').css("top", (y-25)+"px");
                                $('#joystick_overlay').css("left" ,(x-25)+"px");

                                $('#joystick_base').css("display","block");
                                $('#joystick_base').css("top", (joystick_start[1]-radius)+"px");
                                $('#joystick_base').css("left" ,(joystick_start[0]-radius)+"px");
                            }

                        }

                    }else{
                        /* TODO: calculate intersection with outer circle */
                        $('#output').html("w/o: joystick "+ x + ":" + y);
                    }
                    evt.preventDefault();
                });

                $('#joystick').on('touchend', function(evt){
                    joystick_start = [-1,-1];
                    $('#output').html("joystick end");
                    $('#joystick_overlay').css("display","none");
                    $('#joystick_base').css("display","none");
                });

                /******************************************
                  JOYSTICK 2
                  *****************************************/
                /*$(document).on('touchstart touchmove', '#joystick2', function(evt){*/
                $('#joystick2').on('touchstart touchmove', function(evt){
                    var touch = evt.originalEvent.targetTouches[0];
                    var offset = $('#joystick2').offset();
                    var x = touch.clientX - offset.left;
                    var y = touch.clientY - offset.top;
                    if (!(
                        touch.clientX <= $(this).offset().left || touch.clientX >= $(this).offset().left + $(this).outerWidth() ||
                        touch.clientY <= $(this).offset().top  || touch.clientY >= $(this).offset().top + $(this).outerHeight())){
                            $('#output3').html("joystick2 "+ x + ":" + y);
                    }
                    evt.preventDefault();
                });


            });

            window.oncontextmenu = function(evt){
                evt.preventDefault();
                evt.stopPropagation();
                return false;
            }
        </script>

    </body>
</html>
